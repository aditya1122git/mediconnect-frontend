"use strict";(self.webpackChunkmediconnect_frontend=self.webpackChunkmediconnect_frontend||[]).push([[518],{518:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var o=a(379),s=a(43),n=a(216),r=a(996),l=a(528),i=a(535),d=a(579);const c=()=>{const{id:e}=(0,n.g)(),t=(0,n.Zp)(),a=(0,n.zy)(),{currentUser:c}=(0,l.A)(),m=new URLSearchParams(a.search),[p,h]=(0,s.useState)(null),[u,y]=(0,s.useState)(!0),[g,x]=(0,s.useState)(!1),[f,b]=(0,s.useState)(""),[j,v]=(0,s.useState)(!1),[S,N]=(0,s.useState)({date:m.get("date")||(0,i.GP)(new Date,"yyyy-MM-dd"),timeSlot:m.get("slot")||"",reason:"",notes:""}),[k,A]=(0,s.useState)([]),w=(0,s.useCallback)((async()=>{try{y(!0);const t=await r.qJ.getDoctorById(e);t.data.success?h(t.data.data):b("Failed to fetch doctor details")}catch(t){console.error("Error fetching doctor details:",t),b("Error loading doctor information. Please try again later.")}finally{y(!1)}}),[e]),C=(0,s.useCallback)((async()=>{try{const t=await r.qJ.getDoctorAvailability(e,S.date);t.data.success&&(A(t.data.availableSlots),S.timeSlot&&!t.data.availableSlots.includes(S.timeSlot)&&N((e=>(0,o.A)((0,o.A)({},e),{},{timeSlot:""}))))}catch(t){console.error("Error fetching availability:",t)}}),[e,S.date,S.timeSlot]);(0,s.useEffect)((()=>{c&&"patient"!==c.role?b("Only patients can book appointments"):w()}),[c,w]),(0,s.useEffect)((()=>{p&&C()}),[p,C]);const D=e=>{const{name:t,value:a}=e.target;N((e=>(0,o.A)((0,o.A)({},e),{},{[t]:a})))},M=new Date,F=(0,i.GP)(M,"yyyy-MM-dd"),P=(0,i.GP)(new Date(M.setMonth(M.getMonth()+3)),"yyyy-MM-dd"),E={display:"flex",alignItems:"center",padding:"8px 12px",borderRadius:"8px",backgroundColor:"#f5f5f5",transition:"all 0.2s",cursor:"pointer",margin:"0 0 8px 0"},B={marginRight:"10px",marginTop:"0",position:"static"},R={marginBottom:"0",fontWeight:"500",whiteSpace:"nowrap"};return u?(0,d.jsx)("div",{className:"loading",children:"Loading..."}):p?(0,d.jsxs)("div",{className:"book-appointment",children:[(0,d.jsx)("h1",{children:"Book an Appointment"}),j&&(0,d.jsx)("div",{className:"alert alert-success",children:"Appointment booked successfully! Redirecting to your appointments..."}),f&&(0,d.jsx)("div",{className:"alert alert-danger",children:f}),(0,d.jsx)("div",{className:"doctor-info card mb-4",children:(0,d.jsxs)("div",{className:"card-body",children:[(0,d.jsxs)("h3",{children:["Doctor: ",p.name]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Specialization:"})," ",p.specialization]})]})}),(0,d.jsx)("div",{className:"appointment-form card",children:(0,d.jsx)("div",{className:"card-body",children:(0,d.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),S.timeSlot)if(S.reason.trim())try{x(!0),b("");const a={doctorId:e,date:S.date,timeSlot:S.timeSlot,reason:S.reason,notes:S.notes};(await r.Es.createAppointment(a)).data.success?(v(!0),N({date:(0,i.GP)(new Date,"yyyy-MM-dd"),timeSlot:"",reason:"",notes:""}),setTimeout((()=>{t("/appointments")}),2e3)):b("Failed to book appointment")}catch(o){console.error("Error booking appointment:",o),o.response&&o.response.data?b(o.response.data.error||"Failed to book appointment"):b("Failed to book appointment. Please try again later.")}finally{x(!1)}else b("Please provide a reason for the appointment");else b("Please select a time slot")},children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"date",children:"Appointment Date:"}),(0,d.jsx)("input",{type:"date",id:"date",name:"date",className:"form-control",value:S.date,onChange:D,min:F,max:P,required:!0})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"timeSlot",children:"Available Time Slots:"}),0===k.length?(0,d.jsx)("p",{className:"text-danger",children:"No available slots for the selected date."}):(0,d.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"10px",marginTop:"10px"},children:k.map((e=>(0,d.jsxs)("div",{style:E,children:[(0,d.jsx)("input",{style:B,type:"radio",name:"timeSlot",id:"slot-".concat(e.replace(/\s+/g,"")),value:e,checked:S.timeSlot===e,onChange:D}),(0,d.jsx)("label",{style:R,htmlFor:"slot-".concat(e.replace(/\s+/g,"")),children:e})]},e)))})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"reason",children:"Reason for Appointment:"}),(0,d.jsx)("input",{type:"text",id:"reason",name:"reason",className:"form-control",value:S.reason,onChange:D,placeholder:"Brief reason for your visit",required:!0})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"notes",children:"Additional Notes (Optional):"}),(0,d.jsx)("textarea",{id:"notes",name:"notes",className:"form-control",value:S.notes,onChange:D,placeholder:"Any additional information you'd like to share",rows:"3"})]}),(0,d.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:g||0===k.length||!S.timeSlot,children:g?"Booking...":"Book Appointment"})]})})})]}):(0,d.jsx)("div",{className:"error alert alert-danger",children:"Doctor not found"})}}}]);
//# sourceMappingURL=518.dab62f00.chunk.js.map