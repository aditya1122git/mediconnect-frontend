"use strict";(self.webpackChunkmediconnect_frontend=self.webpackChunkmediconnect_frontend||[]).push([[596],{596:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var l=a(379),s=a(43),r=a(304),o=a(58),d=a(996),n=a(528),i=a(579);r.t1.register(...r.$L);const c=()=>{const[e,t]=(0,s.useState)([]),[a,r]=(0,s.useState)(!0),[c,h]=(0,s.useState)(""),{currentUser:u}=(0,n.A)(),[x,j]=(0,s.useState)(null),[p,v]=(0,s.useState)(!1),[m,b]=(0,s.useState)({startDate:"",endDate:"",type:"all"}),g=async()=>{try{r(!0);const e=await d.jz.getHealthRecords({startDate:m.startDate||void 0,endDate:m.endDate||void 0,type:"all"===m.type?void 0:m.type});e.data&&e.data.data?t(e.data.data):(t([]),h("Invalid data structure received from server"))}catch(l){var e,a;h((null===(e=l.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"Failed to fetch health records"),console.error("Error fetching health records:",l)}finally{r(!1)}};(0,s.useEffect)((()=>{g()}),[]);const y=e=>{const{name:t,value:a}=e.target;b((e=>(0,l.A)((0,l.A)({},e),{},{[t]:a})))},D=e=>!(!u||!e)&&("doctor"===u.role?e.doctor&&e.doctor._id===u.id:"patient"===u.role&&!e.doctor),N=t=>{if(!e.length)return null;const a=[...e].sort(((e,t)=>new Date(e.date)-new Date(t.date))),l=a.map((e=>new Date(e.date).toLocaleDateString()));let s=[];switch(t){case"bloodPressure":return{labels:l,datasets:[{label:"Systolic",data:a.map((e=>{var t;return(null===(t=e.bloodPressure)||void 0===t?void 0:t.systolic)||null})),borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.5)",tension:.2},{label:"Diastolic",data:a.map((e=>{var t;return(null===(t=e.bloodPressure)||void 0===t?void 0:t.diastolic)||null})),borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.2}]};case"heartRate":s=a.map((e=>e.heartRate||null));break;case"weight":s=a.map((e=>e.weight||null));break;case"glucoseLevel":s=a.map((e=>e.glucoseLevel||null));break;default:return null}return{labels:l,datasets:[{label:t.charAt(0).toUpperCase()+t.slice(1),data:s,borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)",tension:.2}]}},f={responsive:!0,plugins:{tooltip:{mode:"index",intersect:!1},title:{display:!0,text:"Health Data Over Time"}},scales:{x:{title:{display:!0,text:"Date"}},y:{title:{display:!0,text:"Value"}}}};return(0,i.jsxs)("div",{className:"view-history",children:[(0,i.jsx)("h1",{children:"Health Records History"}),c&&(0,i.jsx)("div",{className:"alert alert-danger",children:c}),x&&(0,i.jsx)("div",{className:"modal-backdrop",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsx)("h2",{children:"Confirm Delete"}),(0,i.jsxs)("p",{children:["Are you sure you want to delete this health record from ",new Date(x.date).toLocaleDateString(),"?"]}),(0,i.jsx)("p",{children:"This action cannot be undone."}),(0,i.jsxs)("div",{className:"modal-actions",children:[(0,i.jsx)("button",{className:"btn btn-danger",onClick:async()=>{if(x)try{v(!0),console.log("Deleting health record with ID:",x._id),await d.jz.deleteHealthRecord(x._id),t((e=>e.filter((e=>e._id!==x._id)))),j(null)}catch(s){var e,a,l;console.error("Error details:",(null===(e=s.response)||void 0===e?void 0:e.data)||s.message),h((null===(a=s.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.error)||"Failed to delete record")}finally{v(!1)}},disabled:p,children:p?"Deleting...":"Delete"}),(0,i.jsx)("button",{className:"btn btn-secondary",onClick:()=>{j(null)},disabled:p,children:"Cancel"})]})]})}),(0,i.jsx)("div",{className:"filter-form",children:(0,i.jsx)("form",{onSubmit:e=>{e.preventDefault(),g()},children:(0,i.jsxs)("div",{className:"filter-row",children:[(0,i.jsxs)("div",{className:"filter-group",children:[(0,i.jsx)("label",{htmlFor:"startDate",children:"Start Date"}),(0,i.jsx)("input",{type:"date",id:"startDate",name:"startDate",value:m.startDate,onChange:y,className:"form-control"})]}),(0,i.jsxs)("div",{className:"filter-group",children:[(0,i.jsx)("label",{htmlFor:"endDate",children:"End Date"}),(0,i.jsx)("input",{type:"date",id:"endDate",name:"endDate",value:m.endDate,onChange:y,className:"form-control"})]}),(0,i.jsxs)("div",{className:"filter-group",children:[(0,i.jsx)("label",{htmlFor:"type",children:"Data Type"}),(0,i.jsxs)("select",{id:"type",name:"type",value:m.type,onChange:y,className:"form-control",children:[(0,i.jsx)("option",{value:"all",children:"All Data"}),(0,i.jsx)("option",{value:"bloodPressure",children:"Blood Pressure"}),(0,i.jsx)("option",{value:"heartRate",children:"Heart Rate"}),(0,i.jsx)("option",{value:"weight",children:"Weight"}),(0,i.jsx)("option",{value:"glucoseLevel",children:"Glucose Level"})]})]}),(0,i.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Filter"})]})})}),a?(0,i.jsx)("div",{className:"loading",children:"Loading health records..."}):0===e.length?(0,i.jsx)("div",{className:"no-records",children:(0,i.jsx)("p",{children:"No health records found for the selected period."})}):(0,i.jsxs)("div",{className:"health-charts",children:[("all"===m.type||"bloodPressure"===m.type)&&N("bloodPressure")&&(0,i.jsxs)("div",{className:"chart-container",children:[(0,i.jsx)("h3",{children:"Blood Pressure"}),(0,i.jsx)(o.N1,{data:N("bloodPressure"),options:f})]}),("all"===m.type||"heartRate"===m.type)&&N("heartRate")&&(0,i.jsxs)("div",{className:"chart-container",children:[(0,i.jsx)("h3",{children:"Heart Rate"}),(0,i.jsx)(o.N1,{data:N("heartRate"),options:f})]}),("all"===m.type||"weight"===m.type)&&N("weight")&&(0,i.jsxs)("div",{className:"chart-container",children:[(0,i.jsx)("h3",{children:"Weight"}),(0,i.jsx)(o.N1,{data:N("weight"),options:f})]}),("all"===m.type||"glucoseLevel"===m.type)&&N("glucoseLevel")&&(0,i.jsxs)("div",{className:"chart-container",children:[(0,i.jsx)("h3",{children:"Glucose Level"}),(0,i.jsx)(o.N1,{data:N("glucoseLevel"),options:f})]})]}),(0,i.jsxs)("div",{className:"records-table",children:[(0,i.jsx)("h3",{children:"Records List"}),0===e.length?(0,i.jsx)("p",{children:"No records to display"}):(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Date"}),(0,i.jsx)("th",{children:"Blood Pressure"}),(0,i.jsx)("th",{children:"Heart Rate"}),(0,i.jsx)("th",{children:"Weight"}),(0,i.jsx)("th",{children:"Glucose"}),(0,i.jsx)("th",{children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map((e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:new Date(e.date).toLocaleDateString()}),(0,i.jsx)("td",{children:e.bloodPressure?"".concat(e.bloodPressure.systolic,"/").concat(e.bloodPressure.diastolic):"-"}),(0,i.jsx)("td",{children:e.heartRate?"".concat(e.heartRate," bpm"):"-"}),(0,i.jsx)("td",{children:e.weight?"".concat(e.weight," kg"):"-"}),(0,i.jsx)("td",{children:e.glucoseLevel?"".concat(e.glucoseLevel," mg/dL"):"-"}),(0,i.jsx)("td",{children:D(e)&&(0,i.jsx)("button",{className:"btn btn-delete-entry",onClick:()=>(e=>{j(e)})(e),children:"Delete"})})]},e._id)))})]})]})]})}}}]);
//# sourceMappingURL=596.1352f280.chunk.js.map