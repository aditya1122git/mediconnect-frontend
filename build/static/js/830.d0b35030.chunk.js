"use strict";(self.webpackChunkmediconnect_frontend=self.webpackChunkmediconnect_frontend||[]).push([[830],{830:(e,s,t)=>{t.r(s),t.d(s,{default:()=>i});var l=t(43),a=t(216),r=t(475),n=t(996),d=t(579);const i=()=>{var e;const[s,t]=(0,l.useState)([]),[i,o]=(0,l.useState)(!0),[c,h]=(0,l.useState)(""),[m,x]=(0,l.useState)(""),[u,p]=(0,l.useState)(""),[b,g]=(0,l.useState)("all"),[j,v]=(0,l.useState)(""),[y,N]=(0,l.useState)(!1),[f,w]=(0,l.useState)(""),[C,k]=(0,l.useState)(!1),[A,E]=(0,l.useState)(!1),[S,R]=(0,l.useState)(null),[D,L]=(0,l.useState)(!1),[U,P]=(0,l.useState)(!1),[_,F]=(0,l.useState)(!1),[T,z]=(0,l.useState)(!1),M=(0,a.zy)(),O=(0,a.Zp)();(0,l.useEffect)((()=>{const e=new URLSearchParams(M.search).get("role");e&&["doctor","patient"].includes(e)?g(e):g("all")}),[M.search]);const B=(0,l.useCallback)((async()=>{try{let e;o(!0),h(""),e="doctor"===b?await n.Er.getAllDoctors():"patient"===b?await n.Er.getAllPatients():await n.Er.getAllUsers(),e.data&&e.data.success?t(e.data.data||[]):h("Failed to fetch users")}catch(i){var e,s,l,a,r,d;if(console.error("Error fetching users:",i),null!==(e=i.response)&&void 0!==e&&null!==(s=e.data)&&void 0!==s&&null!==(l=s.error)&&void 0!==l&&l.includes("Admin user not found")||null!==(a=i.response)&&void 0!==a&&null!==(r=a.data)&&void 0!==r&&null!==(d=r.message)&&void 0!==d&&d.includes("Admin user not found"))return h("Your admin session has expired. Please sign in again."),void setTimeout((()=>{localStorage.removeItem("token"),window.location.href="/login?session=expired"}),1500);h("Failed to fetch users. Please try again later.")}finally{o(!1)}}),[b]);(0,l.useEffect)((()=>{B()}),[B]);const I=()=>{E(!1),F(!1),N(!1),z(!1),x("")},q=e=>{w(e),N(!0),v("")};return i?(0,d.jsx)("div",{className:"loading",children:"Loading users..."}):(0,d.jsxs)("div",{className:"admin-users",children:[(0,d.jsxs)("div",{className:"page-header d-flex justify-content-between align-items-center",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{children:"User Management"}),(0,d.jsx)("p",{className:"text-muted",children:"Manage all users in the system"})]}),(0,d.jsx)("div",{children:(0,d.jsx)(r.N_,{to:"/admin/dashboard",className:"btn btn-secondary",children:"Back to Dashboard"})})]}),c&&(0,d.jsx)("div",{className:"alert alert-danger",children:c}),m&&(0,d.jsx)("div",{className:"alert alert-danger",children:m}),u&&(0,d.jsx)("div",{className:"alert alert-success",children:u}),(0,d.jsx)("div",{className:"filters mb-4",children:(0,d.jsxs)("div",{className:"row",children:[(0,d.jsx)("div",{className:"col-md-6",children:(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"roleFilter",children:"Filter by Role:"}),(0,d.jsxs)("select",{id:"roleFilter",className:"form-control",value:b,onChange:e=>{const s=e.target.value;O("all"===s?"/admin/users":"/admin/users?role=".concat(s))},children:[(0,d.jsx)("option",{value:"all",children:"All Users"}),(0,d.jsx)("option",{value:"doctor",children:"Doctors Only"}),(0,d.jsx)("option",{value:"patient",children:"Patients Only"})]})]})}),(0,d.jsx)("div",{className:"col-md-6",children:(0,d.jsxs)("div",{className:"bulk-actions mt-4",children:["doctor"===b&&(0,d.jsx)("button",{className:"btn btn-danger",onClick:()=>q("doctors"),disabled:C,children:"Delete All Doctors"}),"patient"===b&&(0,d.jsx)("button",{className:"btn btn-danger",onClick:()=>q("patients"),disabled:C,children:"Delete All Patients"})]})})]})}),0===s.length?(0,d.jsx)("div",{className:"no-users",children:(0,d.jsx)("p",{children:"No users found."})}):(0,d.jsx)("div",{className:"table-responsive",children:(0,d.jsxs)("table",{className:"table table-striped",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"Name"}),(0,d.jsx)("th",{children:"Email"}),(0,d.jsx)("th",{children:"Role"}),(0,d.jsx)("th",{children:"Created"}),(0,d.jsx)("th",{children:"Actions"})]})}),(0,d.jsx)("tbody",{children:s.map((e=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:e.name}),(0,d.jsx)("td",{children:e.email}),(0,d.jsx)("td",{children:(0,d.jsx)("span",{className:"badge badge-".concat("doctor"===e.role?"primary":"success"),children:e.role&&e.role.charAt(0).toUpperCase()+e.role.slice(1)})}),(0,d.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,d.jsx)("td",{children:(0,d.jsxs)("div",{className:"btn-group",children:[(0,d.jsx)(r.N_,{to:"/admin/users/".concat(e._id),className:"btn btn-sm btn-info",children:"View"}),(0,d.jsx)("button",{className:"btn btn-sm btn-danger",onClick:()=>(e=>{const t=s.find((s=>s._id===e));t&&(R(t),E(!0),v(""),x(""))})(e._id),disabled:C,children:"Delete"})]})})]},e._id)))})]})}),A&&S&&(0,d.jsx)("div",{className:"modal show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:(0,d.jsx)("div",{className:"modal-dialog modal-dialog-centered",style:{maxWidth:"400px"},children:(0,d.jsx)("div",{className:"modal-content",style:{borderRadius:"8px"},children:(0,d.jsxs)("div",{className:"p-0",children:[(0,d.jsxs)("div",{className:"bg-danger text-white p-2 position-relative",style:{borderRadius:"8px 8px 0 0"},children:[(0,d.jsxs)("div",{className:"d-flex align-items-center",children:[(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",className:"mr-2",viewBox:"0 0 16 16",children:[(0,d.jsx)("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}),(0,d.jsx)("path",{d:"M5.255 5.786a.237.237 0 0 0 0 .334c.78.618 2.519 1.764 3.585 1.764s2.798-1.146 3.585-1.764a.237.237 0 0 0 0-.334c-.78-.618-2.519-1.764-3.585-1.764s-2.798 1.146-3.585 1.764z"})]}),(0,d.jsx)("h5",{className:"modal-title m-0 font-weight-bold",children:"Delete User"})]}),(0,d.jsx)("button",{type:"button",className:"close position-absolute text-white",style:{top:"8px",right:"12px"},onClick:I,disabled:C,children:(0,d.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]}),(0,d.jsxs)("div",{className:"p-3",children:[(0,d.jsx)("div",{className:"bg-light border rounded p-2 mb-3 text-center",children:(0,d.jsxs)("div",{className:"d-flex align-items-center justify-content-center",children:[(0,d.jsx)("div",{className:"rounded-circle text-white d-flex align-items-center justify-content-center mr-2",style:{width:"40px",height:"40px",fontSize:"18px",backgroundColor:"#007bff"},children:(null===(e=S.name)||void 0===e?void 0:e.charAt(0).toUpperCase())||"U"}),(0,d.jsxs)("div",{className:"text-left",children:[(0,d.jsx)("h6",{className:"mb-0 font-weight-bold",children:S.name}),(0,d.jsx)("p",{className:"mb-0 small text-muted",children:S.email})]})]})}),(0,d.jsx)("div",{className:"alert alert-warning py-1 px-2 mb-3",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeeba"},children:(0,d.jsxs)("p",{className:"mb-0 text-center small",style:{color:"#ff8800"},children:[(0,d.jsx)("strong",{children:"Warning:"})," This will permanently delete this user and all their data."]})}),m&&(0,d.jsx)("div",{className:"alert alert-danger py-1 px-2 mb-3 text-center small",children:m}),(0,d.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,d.jsx)("button",{type:"button",className:"btn btn-success px-3",style:{borderRadius:"25px",width:"45%"},onClick:I,disabled:C,children:"CANCEL"}),(0,d.jsx)("button",{type:"button",className:"btn btn-danger px-3",style:{borderRadius:"25px",width:"45%",backgroundColor:"#e74c3c"},onClick:()=>{E(!1),F(!0)},disabled:C,children:"DELETE USER"})]})]})]})})})}),_&&S&&(0,d.jsx)("div",{className:"modal show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:(0,d.jsx)("div",{className:"modal-dialog modal-sm modal-dialog-centered",children:(0,d.jsx)("div",{className:"modal-content",style:{borderRadius:"8px"},children:(0,d.jsxs)("div",{className:"p-0",children:[(0,d.jsx)("div",{className:"bg-danger text-white p-2 position-relative",style:{borderRadius:"8px 8px 0 0"},children:(0,d.jsx)("div",{className:"d-flex align-items-center justify-content-center",children:(0,d.jsx)("h5",{className:"modal-title m-0 font-weight-bold",children:"Confirm Deletion"})})}),(0,d.jsxs)("div",{className:"p-3 text-center",children:[(0,d.jsx)("p",{children:"Are you sure you want to delete this user?"}),m&&(0,d.jsx)("div",{className:"alert alert-danger py-1 px-2 mb-3 text-center small",children:m}),(0,d.jsx)("button",{type:"button",className:"btn btn-danger px-5 py-2 text-center d-flex justify-content-center align-items-center",style:{borderRadius:"25px",backgroundColor:"#e74c3c",width:"80%",margin:"0 auto"},onClick:async()=>{try{k(!0),x(""),p(""),console.log("Attempting to delete user without authentication");try{console.log("Attempting primary delete method with bypass-auth header");const e=await n.Er.deleteUser(S._id);if(console.log("Delete user response:",e.data),e.data&&e.data.success)return p("User ".concat(S.name," deleted successfully")),t(s.filter((e=>e._id!==S._id))),void F(!1)}catch(a){console.log("First delete method failed, trying alternative method..."),console.log("Error details:",a);try{console.log("Attempting alternative force-delete method");const e=await n.Er.deleteUserAlternative(S._id);if(console.log("Alternative delete response:",e.data),e.data&&e.data.success)return p("User ".concat(S.name," deleted successfully")),t(s.filter((e=>e._id!==S._id))),void F(!1);throw a}catch(r){var e,l;throw console.log("Both delete methods failed"),console.log("Alternative method error:",r),null!==(e=r.response)&&void 0!==e&&null!==(l=e.data)&&void 0!==l&&l.error?r:a}}x("Failed to delete user")}catch(d){console.error("Error deleting user:",d);let e="User deletion failed. Please try again.";if(d.response){const s=d.response.status;console.log("Delete user error response status:",s),console.log("Error response data:",JSON.stringify(d.response.data)),d.response.data&&d.response.data.error&&(e=d.response.data.error,e.toLowerCase().includes("password is required")?e="Server error: The system is still requiring password authentication. Please contact the administrator.":e.toLowerCase().includes("auth")||e.toLowerCase().includes("password")?e="Authentication error. Please reload the page and try again.":404===s&&(e="User could not be found. They may have been already deleted."))}x(e)}finally{k(!1)}},disabled:C,children:C?"DELETING...":"CONFIRM"})]})]})})})}),y&&(0,d.jsx)("div",{className:"modal show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:(0,d.jsx)("div",{className:"modal-dialog modal-dialog-centered",style:{maxWidth:"400px"},children:(0,d.jsx)("div",{className:"modal-content",style:{borderRadius:"8px"},children:(0,d.jsxs)("div",{className:"p-0",children:[(0,d.jsxs)("div",{className:"bg-danger text-white p-2 position-relative",style:{borderRadius:"8px 8px 0 0"},children:[(0,d.jsxs)("div",{className:"d-flex align-items-center",children:[(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",className:"mr-2",viewBox:"0 0 16 16",children:[(0,d.jsx)("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}),(0,d.jsx)("path",{d:"M5.255 5.786a.237.237 0 0 0 0 .334c.78.618 2.519 1.764 3.585 1.764s2.798-1.146 3.585-1.764a.237.237 0 0 0 0-.334c-.78-.618-2.519-1.764-3.585-1.764s-2.798 1.146-3.585 1.764z"})]}),(0,d.jsxs)("h5",{className:"modal-title m-0 font-weight-bold",children:["Delete All ",f]})]}),(0,d.jsx)("button",{type:"button",className:"close position-absolute text-white",style:{top:"8px",right:"12px"},onClick:()=>N(!1),disabled:C,children:(0,d.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]}),(0,d.jsxs)("div",{className:"p-3",children:[(0,d.jsx)("div",{className:"alert alert-warning py-1 px-2 mb-3",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeeba"},children:(0,d.jsxs)("p",{className:"mb-0 text-center small",style:{color:"#ff8800"},children:[(0,d.jsx)("strong",{children:"Warning:"})," This will permanently delete all ",f,"."]})}),m&&(0,d.jsx)("div",{className:"alert alert-danger py-1 px-2 mb-3 text-center small",children:m}),(0,d.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,d.jsx)("button",{type:"button",className:"btn btn-success px-3",style:{borderRadius:"25px",width:"45%"},onClick:()=>N(!1),disabled:C,children:"CANCEL"}),(0,d.jsx)("button",{type:"button",className:"btn btn-danger px-3",style:{borderRadius:"25px",width:"45%",backgroundColor:"#e74c3c"},onClick:()=>{N(!1),z(!0)},disabled:C,children:"DELETE ALL"})]})]})]})})})}),T&&(0,d.jsx)("div",{className:"modal show",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:(0,d.jsx)("div",{className:"modal-dialog modal-sm modal-dialog-centered",children:(0,d.jsx)("div",{className:"modal-content",style:{borderRadius:"8px"},children:(0,d.jsxs)("div",{className:"p-0",children:[(0,d.jsx)("div",{className:"bg-danger text-white p-2 position-relative",style:{borderRadius:"8px 8px 0 0"},children:(0,d.jsx)("div",{className:"d-flex align-items-center justify-content-center",children:(0,d.jsx)("h5",{className:"modal-title m-0 font-weight-bold",children:"Confirm Deletion"})})}),(0,d.jsxs)("div",{className:"p-3 text-center",children:[(0,d.jsxs)("p",{children:["Are you sure you want to delete all ",f,"?"]}),m&&(0,d.jsx)("div",{className:"alert alert-danger py-1 px-2 mb-3 text-center small",children:m}),(0,d.jsx)("button",{type:"button",className:"btn btn-danger px-5 py-2 text-center d-flex justify-content-center align-items-center",style:{borderRadius:"25px",backgroundColor:"#e74c3c",width:"80%",margin:"0 auto"},onClick:async()=>{try{let e;if(k(!0),x(""),p(""),console.log("Attempting bulk delete without authentication"),"doctors"===f)e=await n.Er.deleteAllDoctors();else{if("patients"!==f)return void x("Invalid operation");e=await n.Er.deleteAllPatients()}e.data&&e.data.success?(p(e.data.message||"Bulk deletion completed successfully"),z(!1),B()):x("Failed to complete operation")}catch(t){var e,s;console.error("Error in bulk operation:",t);let l=(null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.error)||"Operation failed. Please try again.";if(t.response){const e=t.response.status;console.log("Bulk delete error response status:",e),console.log("Error response data:",JSON.stringify(t.response.data)),l.toLowerCase().includes("password is required")?l="Server error: The system is still requiring password authentication. Please contact the administrator.":(l.toLowerCase().includes("auth")||l.toLowerCase().includes("password"))&&(l="Authentication error. Please reload the page and try again.")}x(l)}finally{k(!1)}},disabled:C,children:C?"PROCESSING...":"CONFIRM"})]})]})})})})]})}}}]);
//# sourceMappingURL=830.d0b35030.chunk.js.map